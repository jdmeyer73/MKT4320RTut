```{r echo=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
```

# Alt-Specific MNL

Data for this chapter:

* The [yogurt.rdata](Data/yogurt.rdata) is used. Load it now.  Because of how the data is arranged, the training and holdout samples are both included in the file: `train.yog` and `test.yog`.
    ```{r}
    # You may need to change the directory
    load("Data/yogurt.rdata")
    ```

## Introduction

Base R is not good for alternative specific multinomial logistic regression (MNL). The best package that I have found for alternative specific MNL is `mlogit` with its `mlogit` function. Use `install.packages("mlogit")` to install the package on your machine, then load it using the `library` function when needed.

``` {r}
library(mlogit)
```

However, even that is not very user friendly (in my opinion).  Therefore, I have written a few user defined functions to help with getting the necessary results from an alternative specific MNLInstall that package `install.packages("nnet")` and load it.
* [asmnl_est.R](asmnl_est.R) produces Odds Ratio coefficients table, overall model significance, McFadden's Pseudo-$R^2$, and classification matrices for both the training data and the test/holdout data
* [asmnl_me.R](stmnl_cm.R) produces marginal effects tables for all IVs
* [asmnl_mp.R](stmnl_pp.R) produces margin plots for case-specific IVs

## Alt-Spec MNL using User Defined Function

* Alternative Specific MNL is performed using the `asmnl_est.R` user defined function
* Usage: `asmnl_est(formula, data, id="", alt="", choice="", testdata)`
    * `formula` is an object with a saved formula.  The formula is represented by a DV on the left side separated from the IVs on the right side by a tilde(`~`). The IVs are further separated by having choice-specific variables on the left and the case-specific variables on the right, separated by a vertical line, `|`.  For example:
        * `myform = choice ~ chvar1 + chvar2 | casvar1 + casvar2`
    * `data` is the name of the training data
    * `id` is the variable that identifies the case (in quotes)
    * `alt` is the variable that identifies the choice (in quotes)
    * `choice` is the variable that identifies if `alt` was selected or not
    * `testdata` is the name of the test data
* The function will display the coefficients table, overall model significance, McFadden's Pseudo-$R^2$, and classification matrices for both the training data and the test/holdout data
* In addition, the results should be saved to an object to be used in other user defined functions
* NOTE 1: To work properly, all factor IVs should already be in dummy variable coding
* NOTE 2: This function also requires the `broom` package

``` {r}
library(mlogit)
# Saving formula to object
myform <- choice ~ feat + price | income

source("asmnl_est.R")
asmod <- asmnl_est(formula=myform,
               data=train.yog,
               id="id",
               alt="brand",
               choice="choice",
               testdata=test.yog)
```

### Marginal Effects

* The `asmnl_me.R` user defined function will be used to get the marginal effects of the IVs
* Usage: `asmnl_me(mod)`
    * `mod` is the object containing the result of the `mlogit` call using the `asmnl_est` user defined function

```{r}
source("asmnl_me.R")
asmnl_me(asmod)
```

### Margin Plots

* The `asmnl_mp.R` user defined function will create margin plots for a case-specific IV
* Usage: `almnl_mp(mod, focal="", type="")
    * `mod` is the object containing the result of the `mlogit` call using the `asmnl_est` user defined function
    * `focal` is the case-specific IV for which a margin plot is wanted (in quotes)
    * `type` is the type of IV; must be either `"C"` for continuous or `"D"` for dummy
* NOTE: This function requires the `ggplot2` package

``` {r}
source("asmnl_mp.R")
asmnl_mp(asmod,"income", "C")
```